<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css"
	th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}" />

<!-- include java script in the footer -->
<script type="text/javascript"
	th:src="@{/webjars/jquery/3.2.1/jquery.min.js/}"></script>
<script type="text/javascript"
	th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>

<title>Spring Boot APP with MongoDB</title>

<style>
    body {
        background-color: #f5f5f5;
        padding-bottom: 30px;
    }
    
    .blue-badge {
        background-color: #007bff;
        color: white;
        padding: 4px 10px;
        border-radius: 4px;
        display: inline-block;
        margin-bottom: 5px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-top: 20px;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    table {
        margin-top: 20px;
        background-color: white;
    }
    
    .footer-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #ddd;
    }
</style>
</head>
<body>
	<div class="container">
		<h1 class="text-center">Student Registration System</h1>
		
		<div class="row">
			<div class="col-md-6">
				<form name="saveUser" action="/save" method="post" class="form-horizontal">
					<div class="form-group">
						<div class="blue-badge">First Name</div>
						<input type="text" id="firstName" class="form-control" 
						       placeholder="Enter first name" name="firstName" required />
					</div>

					<div class="form-group">
						<div class="blue-badge">Last Name</div>
						<input type="text" id="lastName" class="form-control" 
						       placeholder="Enter last name" name="lastName" required>
					</div>
					
					<div class="form-group">
						<div class="blue-badge">Age</div>
						<input type="number" id="age" class="form-control" 
						       placeholder="Enter age" name="age" min="1" max="100" required>
					</div>

					<div class="form-group">
						<div class="blue-badge">Email</div>
						<input type="email" id="email" class="form-control" 
						       placeholder="Enter email" name="email" required>
					</div>
					
					<div class="form-group">
						<button type="submit" class="btn btn-primary">
							<i class="glyphicon glyphicon-user"></i> Register Student
						</button>
					</div>
				</form>
			</div>
			
			<div class="col-md-6">
				<h3>Registration Info</h3>
				<div class="well">
					<p>Fill in all fields marked with blue badges and click "Register Student" to save.</p>
					<p>The student will appear in the table below.</p>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12">
				<h2>Registered Students</h2>
				<table id="usersTable" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>ID</th>
							<th>First Name</th>
							<th>Last Name</th>
							<th>Age</th>
							<th>Email</th>
						</tr>
					</thead>
					<tbody>
						<!-- Data will be populated by JavaScript -->
					</tbody>
				</table>
			</div>
		</div>

		<div class="row footer-section">
			<div class="col-md-3">
				<img th:src="@{/img/logo1.png}" alt="logo1.png" height="150" 
				     style="border-radius: 8px; border: 2px solid #007bff; padding: 5px;">
			</div>
			<div class="col-md-9">
				<h4 class="text-center">E&E Cloud Technology & DevOps Automation.</h4>							
			</div>
		</div>
	</div>

	<script>
		$(document).ready(function() {
			// Load existing users
			loadUsers();
			
			// Handle form submission
			$('form[name="saveUser"]').submit(function(e) {
				e.preventDefault();
				
				var formData = $(this).serialize();
				
				$.ajax({
					url: $(this).attr('action'),
					type: 'POST',
					data: formData,
					success: function(response) {
						// Clear form
						$('form[name="saveUser"]')[0].reset();
						
						// Reload users
						loadUsers();
						
						// Show success message
						alert('Student registered successfully!');
					},
					error: function() {
						alert('Error registering student');
					}
				});
			});
		});
		
		function loadUsers() {
			$.ajax({
				url: "/api/users",
				success: function(response) {
					var tbody = $("#usersTable tbody");
					tbody.empty();
					
					if (response.length === 0) {
						tbody.append('<tr><td colspan="5" class="text-center">No students registered yet</td></tr>');
						return;
					}
					
					$.each(response, function(i, item) {
						var row = $("<tr />");
						$("#usersTable tbody").append(row);
						
						row.append($("<td>" + (item.id || 'N/A') + "</td>"));
						row.append($("<td>" + item.firstName + "</td>"));
						row.append($("<td>" + item.lastName + "</td>"));
						row.append($("<td>" + (item.age || 'N/A') + "</td>"));
						row.append($("<td>" + item.email + "</td>"));
					});
				},
				error: function() {
					$("#usersTable tbody").html('<tr><td colspan="5" class="text-center">Error loading data</td></tr>');
				}
			});
		}
	</script>
</body>
</html>